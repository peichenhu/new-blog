<!DOCTYPE html>
<html>
    <head>
        <meta name="screen-orientation" content="portrait" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" />
        <title>抽奖</title>
        <link rel="stylesheet" type="text/css" href="css/reset.css" />
        <link rel="stylesheet" type="text/css" href="css/wall.css" />
        <link rel="stylesheet" type="text/css" href="css/setting.css" />
    </head>
    <body>
        <div id="main" class="wall">
            <div class="jump">
                <div class="result-btn">
                    <a href="./index.html">抽奖首页</a>
                </div>
                <div class="result-btn">
                    <a href="./result.html">获奖名单</a>
                </div>
            </div>

            <div class="result-title">抽奖设置</div>
            <div class="box">
                <div class="title">
                    人员名单 ({{userCout}})
                    <span class="fr btn" @click="save">保存</span>
                    <span class="fr btn" @click="resetUser">重置并保存 &nbsp;&nbsp;</span>
                </div>
                <textarea v-model="userList" cols="30" rows="10"></textarea>
            </div>
            <div class="box">
                <div class="title">
                    奖品设置 ({{awardCount}})
                    <span class="fr btn" @click="save">保存</span>
                    <span class="fr btn" @click="resetAward">重置并保存 &nbsp;&nbsp;</span>
                </div>
                <textarea v-model="award" cols="30" rows="10"></textarea>
            </div>
        </div>
        <script type="text/javascript" src="js/vue.js"></script>
        <script type="text/javascript">
            var userList = `郭襄,王勃,杜牧,李恪,段毓,蒙毅,季梦,冉舒,朱穆,殷梨亭,瞿秋白,莫声谷,储光羲,贾雨村,曹雪芹,穆念慈,顾惜朝,辛弃疾,李慕白,梁漱溟,徐悲鸿,梅超风,何其芳,秦可卿,傅斯年,钟子期,安又琪,宋之问,林黛玉,左冷禅,颜真卿,宋青书,岳灵珊,刘半农,伍次友,朱九真,张三丰,孙伯符,孙仲谋,刘半农,伍次友,朱九真,张三丰,孙伯符,孙仲谋`;
            var award = `{
    "一等奖": 1,
    "二等奖": 3,
    "三等奖": 10,
    "四等奖": 20,
    "五等奖": 50
}`;

            new Vue({
                el: '#main',
                data: {
                    results: [],
                    userCout: 0,
                    userList: userList,
                    award: award,
                    awardCount: 0,
                },
                watch: {
                    userList: {
                        handler: function (str) {
                            console.log('watch', str);
                            this.userList = str.replace('，', ',');
                            this.userCout = this.userList.split(',').length;
                        },
                        immediate: true,
                    },
                    award: {
                        handler: function (str) {
                            try {
                                var award = JSON.parse(str.replace(' ', '').replace('\n', ''));
                                this.awardCount = Object.keys(award).length;
                                if (Object.keys(award).find(key => award[key] <= 0)) {
                                    throw new Error('奖品设置格式不正确, 个数不能小于 0');
                                }
                                console.log('watch', award);
                            } catch (error) {
                                alert(error.message, '奖品设置格式不正确，请重置后再设置');
                            }
                            console.log('watch', JSON.parse(str.replace(' ', '').replace('\n', '')));
                        },
                        immediate: true,
                    },
                },
                methods: {
                    resetUser() {
                        this.userList = userList;
                        this.save();
                    },
                    resetAward() {
                        this.award = award;
                        this.save();
                    },
                    save() {
                        localStorage.clear();
                        var award = JSON.parse(this.award.replace(' ', '').replace('\n', ''));
                        if (Object.keys(award).find(key => award[key] <= 0)) {
                            return alert('奖品设置格式不正确, 个数不能小于 0');
                        }
                        localStorage.setItem('1024_award', JSON.stringify(award));
                        console.log('saveUser', award);
                        localStorage.setItem('1024_userList', this.userList);
                        console.log('saveUser', this.userList);
                        alert('保存成功');
                    },
                },
                mounted() {},
            });
        </script>
    </body>
</html>
